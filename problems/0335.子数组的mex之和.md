# 思维 容斥原理
[题目链接](https://kamacoder.com/problempage.php?pid=1415)
## 思路分析

题目给的数组的取值范围是0, 1， 2。也就是说，只会有如下四种情况：

1. mex = 0 -> 0不出现在子数组中；
2. mex = 1 -> 1不在子数组里面, 但是0一定要在；
3. mex = 2 -> 0和1都出现, 且2不出现；
4. mex = 3 -> 0, 1, 2都出现。

首先，题目要我们求的是``` ans = mex0 * 0 + mex1 * 1 + mex2 * 2 + mex3 * 3 ```，mex_i表示的是mex = i(i取0, 1, 2, 3)时对应的子数组的数量。

由于0乘任何数都等于0，那么我们就只需要求：

- mex = 1 的子数组有多少个？
- mex = 2 的子数组有多少个？
- mex = 3 的子数组有多少个？

最终的答案就是上面的ans。

**设当前子数组为a[l, ..., r]**

明确下面几个变量：

1. cur_i: 表示以当前下标结尾的所有子数组中**不包含数字i**的子数组数量。如cur0表示以当前下标结尾所有子数组的不包含0的子数组数量。
2. cur_ij: 表示以当前下标结尾的**不包含数字i或j**的子数组数量。换句话说就是，只包含另一个数的子数组数。如cur12，表示不包含1或2的子数组数量，也就是只能包含0。因为数组里面只有三种元素。
3. sum_i: 表示所有的**不包含数字i**的子数组数量，这里与上面的区别就是上面是局部值，而这里是累计值，也就是对所有下标的cur_i求和。
4. sum_ij: 与上面的定义类似。
5. mex_i: 表示mex = i时的子数组数量。i取0,1,2,3。

**1. 计算mex = 1时的子数组数。**

子数组必须要包含一个0，且不能含有1。那么就说明子数组只含有0和2，那么求出不包含1的子数组总数，然后减去只包含2的子数组数量。此时，子数组的可能组合为``` {0}, {2}, {0,2} ```，即只包含0，只包含2和0,2都有的组合。我们要求这里面包含0的子数组，就只要求这个总数（不包含1） - 只包含2的数量。即``` mex1 = sum1 - sum01 ```。

**2. 计算mex = 2时的子数组数。**

子数组必须包含0和1，且不能有2。先求不包含2的所有子数组，那么可能的集合为``` {0}, {1}, {0,1} ```。即只包含0，只包含1，和既有0，又有1。因为我们要求mex=2，那么也就是说我们要求的是第三种。所以``` mex2 = sum2 - sum12 - sum02 ```。

**3. 计算mex = 3时的子数组数。**

必须包含0,1,2的所有数。一个长度为n的数组拥有的子数组数是total = n * (n + 1) / 2。此时全部数组可能得集合为``` {0}, {1}, {2}, {0,1}, {0,2}, {1,2}, {0,1,2} ```。我们要求的是最后一个，因为只有0,1,2全部出现，mex才等于3。所以根据容斥原理``` mex3 = total - (sum0 + sum1 + sum2) + (sum01 + sum02 + sum12)```

那么``` ans = mex1 * 1 + mex2 * 2 + mex3 * 3 ```。

## 复杂度分析
1. 时间复杂度：O(n)；
2. 空间复杂度：O(1)。
## 代码实现
### Cpp
``` cpp
#include<bits/stdc++.h>
#define endl '\n'
const int N = 100005, MOD = 1000000007;
using namespace std;
using LL = long long;
using PIL = pair<int, LL>;
using PII = pair<int, int>;
using T3I = tuple<int, int, int>;
int t = 0, dir[]{1, 0, -1, 0, 1};
int main() {
    cin.tie(nullptr) -> sync_with_stdio(false);
    int n;
    cin >> n;
    vector<int> nums(n);
    for (int i = 0; i < n; ++i) cin >> nums[i]; 
    LL total = 1LL * n * (n + 1) / 2;
    LL cur0 = 0, cur1 = 0, cur2 = 0, cur01 = 0, cur02 = 0, cur12 = 0;
    LL sum0 = 0, sum1 = 0, sum2 = 0, sum01 = 0, sum02 = 0, sum12 = 0; 
    for (int t : nums) {
        if (t != 0) ++cur0; else cur0 = 0;
        if (t != 1) ++cur1; else cur1 = 0;
        if (t != 2) ++cur2; else cur2 = 0;
        if (t == 0) ++cur12; else cur12 = 0;
        if (t == 1) ++cur02; else cur02 = 0;
        if (t == 2) ++cur01; else cur01 = 0;
        sum0 += cur0;
        sum1 += cur1;
        sum2 += cur2;
        sum01 += cur01;
        sum02 += cur02;
        sum12 += cur12;
    }
    LL mex1 = sum1 - sum01;
    LL mex2 = sum2 - sum02 - sum12;
    LL mex3 = total - (sum0 + sum1 + sum2) + (sum01 + sum02 + sum12);
    cout << mex1 + mex2 * 2 + mex3 * 3 << endl;
    return 0;
}
```
### Python
``` python
import sys

def solve():
    input = sys.stdin.read().split()
    n = int(input[0])
    a = list(map(int, input[1:1+n]))
    
    total = n * (n + 1) // 2
    
    cur0 = cur1 = cur2 = cur01 = cur02 = cur12 = 0
    sum0 = sum1 = sum2 = sum01 = sum02 = sum12 = 0
    
    for x in a:
        cur0 = cur0 + 1 if x != 0 else 0
        cur1 = cur1 + 1 if x != 1 else 0
        cur2 = cur2 + 1 if x != 2 else 0
        cur01 = cur01 + 1 if x == 2 else 0
        cur02 = cur02 + 1 if x == 1 else 0
        cur12 = cur12 + 1 if x == 0 else 0
        
        sum0 += cur0
        sum1 += cur1
        sum2 += cur2
        sum01 += cur01
        sum02 += cur02
        sum12 += cur12
    
    mex1 = sum1 - sum01
    mex2 = sum2 - sum02 - sum12
    mex3 = total - (sum0 + sum1 + sum2) + (sum01 + sum02 + sum12)
    
    ans = mex1 + 2 * mex2 + 3 * mex3
    print(ans)

if __name__ == "__main__":
    solve()
```
### Java
``` java
import java.io.*;
import java.util.*;

public class Main {
    public static void main(String[] args) throws IOException {
        Reader in = new Reader();
        int n = in.nextInt();
        int[] a = new int[n];
        for (int i = 0; i < n; i++) {
            a[i] = in.nextInt();
        }
        
        long total = (long)n * (n + 1) / 2;
        
        long cur0 = 0, cur1 = 0, cur2 = 0;
        long cur01 = 0, cur02 = 0, cur12 = 0;
        long sum0 = 0, sum1 = 0, sum2 = 0;
        long sum01 = 0, sum02 = 0, sum12 = 0;
        
        for (int x : a) {
            cur0 = (x != 0) ? cur0 + 1 : 0;
            cur1 = (x != 1) ? cur1 + 1 : 0;
            cur2 = (x != 2) ? cur2 + 1 : 0;
            cur01 = (x == 2) ? cur01 + 1 : 0;
            cur02 = (x == 1) ? cur02 + 1 : 0;
            cur12 = (x == 0) ? cur12 + 1 : 0;
            
            sum0 += cur0;
            sum1 += cur1;
            sum2 += cur2;
            sum01 += cur01;
            sum02 += cur02;
            sum12 += cur12;
        }
        
        long mex1 = sum1 - sum01;
        long mex2 = sum2 - sum02 - sum12;
        long mex3 = total - (sum0 + sum1 + sum2) + (sum01 + sum02 + sum12);
        
        long ans = mex1 + 2 * mex2 + 3 * mex3;
        System.out.println(ans);
    }
    
    static class Reader {
        final private int BUFFER_SIZE = 1 << 16;
        private DataInputStream din;
        private byte[] buffer;
        private int bufferPointer, bytesRead;

        public Reader() {
            din = new DataInputStream(System.in);
            buffer = new byte[BUFFER_SIZE];
            bufferPointer = bytesRead = 0;
        }

        public int nextInt() throws IOException {
            int ret = 0;
            byte c = read();
            while (c <= ' ') {
                c = read();
            }
            boolean neg = (c == '-');
            if (neg)
                c = read();
            do {
                ret = ret * 10 + c - '0';
            } while ((c = read()) >= '0' && c <= '9');

            if (neg)
                return -ret;
            return ret;
        }

        private void fillBuffer() throws IOException {
            bytesRead = din.read(buffer, bufferPointer = 0, BUFFER_SIZE);
            if (bytesRead == -1)
                buffer[0] = -1;
        }

        private byte read() throws IOException {
            if (bufferPointer == bytesRead)
                fillBuffer();
            return buffer[bufferPointer++];
        }
    }
}
```
### Go
``` go
package main

import (
	"bufio"
	"fmt"
	"os"
	"strconv"
)

func main() {
	scanner := bufio.NewScanner(os.Stdin)
	scanner.Split(bufio.ScanWords)
	
	// 读取 n
	scanner.Scan()
	n, _ := strconv.Atoi(scanner.Text())
	
	// 读取数组
	a := make([]int, n)
	for i := 0; i < n; i++ {
		scanner.Scan()
		a[i], _ = strconv.Atoi(scanner.Text())
	}
	
	// 总子数组数
	total := int64(n) * int64(n+1) / 2
	
	// 维护不含某些值的连续段长度
	var cur0, cur1, cur2, cur01, cur02, cur12 int64
	// 维护不含某些值的子数组总数
	var sum0, sum1, sum2, sum01, sum02, sum12 int64
	
	for _, x := range a {
		if x != 0 {
			cur0++
		} else {
			cur0 = 0
		}
		if x != 1 {
			cur1++
		} else {
			cur1 = 0
		}
		if x != 2 {
			cur2++
		} else {
			cur2 = 0
		}
		if x == 2 {
			cur01++
		} else {
			cur01 = 0
		}
		if x == 1 {
			cur02++
		} else {
			cur02 = 0
		}
		if x == 0 {
			cur12++
		} else {
			cur12 = 0
		}
		
		sum0 += cur0
		sum1 += cur1
		sum2 += cur2
		sum01 += cur01
		sum02 += cur02
		sum12 += cur12
	}
	
	mex1 := sum1 - sum01
	mex2 := sum2 - sum02 - sum12
	mex3 := total - (sum0 + sum1 + sum2) + (sum01 + sum02 + sum12)
	
	ans := mex1 + 2*mex2 + 3*mex3
	fmt.Println(ans)
}
```